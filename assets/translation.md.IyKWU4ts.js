var W=Object.defineProperty;var Y=(a,e,t)=>e in a?W(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var c=(a,e,t)=>Y(a,typeof e!="symbol"?e+"":e,t);import{E as x,S as T}from"./chunks/types.C-9dMxxX.js";import{i as L}from"./chunks/env.BUzbqU-4.js";import{a as z,b as J}from"./chunks/assert.BQv4eVmx.js";import{T as j,a as G,H as S,U as K,b as q,c as Q,d as X,e as Z,f as ee,_ as te}from"./chunks/stringify.9Pemjmk0.js";import{a as se,b as v,c as P,d as B,e as C,f as $,g as re}from"./chunks/object.util.WadwxJMN.js";import{d as ae,p as O,h as M,v as ne,c as w,o as b,a as U,F as ie,B as oe,t as _,C as le,j as I,ae as ce,G as H}from"./chunks/framework.Xbv-JOCv.js";import"./chunks/is.util.NvFMntWM.js";async function he(a=0,e){return await new Promise((t,s)=>setTimeout(e instanceof Error?s:t,a,e))}class ue{constructor(e){c(this,"fetcher");this.fetcher=e}async load(e){return await this.fetcher.get(`${e}.json`)}}async function de(a,e,t={}){const s=[...a],r=s.length;if(r===0)return[];const{concurrency:n=1/0,errorMode:o=m.THROW_IMMEDIATELY,logger:l=console}=t;if(n===1)return await fe(s,e,o,l);if(s.length<=n)return await pe(s,e,o,l);const h=[],u=[];let i=!1,p=0,g=0;return await new Promise((E,f)=>{const d=()=>{if(i)return;const R=s[g],D=g++;if(g>r){if(p===0){i=!0;const y=h.filter(F=>F!==T);u.length?f(new AggregateError(u,`pMap resulted in ${u.length} error(s)`)):E(y)}return}p++,Promise.resolve(R).then(async y=>await e(y,D)).then(y=>{if(y===x)return i=!0,E(h.filter(F=>F!==T));h[D]=y,p--,d()},y=>{o===m.THROW_IMMEDIATELY?(i=!0,f(y)):(o===m.THROW_AGGREGATED?u.push(y):l==null||l.error(y),p--,d())})};for(let R=0;R<n&&(d(),!i);R++);})}async function fe(a,e,t,s){let r=0;const n=[],o=[];for(const l of a)try{const h=await e(l,r++);if(h===x)break;h!==T&&n.push(h)}catch(h){if(t===m.THROW_IMMEDIATELY)throw h;t===m.THROW_AGGREGATED?o.push(h):s==null||s.error(h)}if(o.length)throw new AggregateError(o,`pMap resulted in ${o.length} error(s)`);return n}async function pe(a,e,t,s){if(t===m.THROW_IMMEDIATELY)return(await Promise.all(a.map((o,l)=>e(o,l)))).filter(o=>o!==T&&o!==x);const r=[],n=[];for(const o of await Promise.allSettled(a.map((l,h)=>e(l,h))))if(o.status==="fulfilled"){if(o.value===x)break;o.value!==T&&r.push(o.value)}else t===m.THROW_AGGREGATED?n.push(o.reason):s==null||s.error(o.reason);if(n.length)throw new AggregateError(n,`pMap resulted in ${n.length} error(s)`);return r}const ye=a=>(console.warn(`[tr] missing: ${a}`),`[${a}]`);class ge{constructor(e,t={}){c(this,"cfg");c(this,"locales");c(this,"currentLocale");this.cfg={...e,missingTranslationHandler:ye},this.locales={...t},this.currentLocale=e.currentLocale||e.defaultLocale}setLocale(e,t){this.locales[e]=t}getLocale(e){return this.locales[e]}async loadLocale(e){const t=Array.isArray(e)?e:[e];await de(t,async s=>{this.locales[s]||(this.locales[s]=await this.cfg.translationLoader.load(s))})}translate(e,t){return this.translateIfExists(e,t)||this.cfg.missingTranslationHandler(e,t)}translateIfExists(e,t){var s,r;return((s=this.locales[this.currentLocale])==null?void 0:s[e])||((r=this.locales[this.cfg.defaultLocale])==null?void 0:r[e])}}function N(a,e=Date.now()){return V(e-a)}function V(a){if(a<1e3)return`${Math.round(a)} ms`;if(a<5e3){const n=a/1e3;return`${Math.trunc(n)===n?n:n.toFixed(3)} sec`}const e=Math.floor(a/1e3)%60,t=Math.floor(a/(60*1e3))%60,s=Math.floor(a/(3600*1e3));return s===0?t===0?`${e} sec`:`${t}m${e}s`:s<24?`${s}h${t}m`:s<48?`${Math.round(s+t/60)}h`:`${Math.floor(s/24)} days`}async function me(a,e){if(!e.timeout)return await a();const{timeout:t,name:s=a.name||"pTimeout function",onTimeout:r}=e,n=e.fakeError||new Error("TimeoutError");return await new Promise(async(o,l)=>{const h=setTimeout(()=>{const u=new j(`"${s}" timed out after ${t} ms`,e.errorData);if(u.stack=n.stack.replace("Error: TimeoutError","TimeoutError: "+u.message),r){try{o(r(u))}catch(i){i.stack=n.stack.replace("Error: TimeoutError",i.name+": "+i.message),l(G(i,e.errorData))}return}l(u)},t);try{o(await a())}catch(u){l(u)}finally{clearTimeout(h)}})}var m;(function(a){a.THROW_IMMEDIATELY="THROW_IMMEDIATELY",a.THROW_AGGREGATED="THROW_AGGREGATED",a.SUPPRESS="SUPPRESS"})(m||(m={}));function Ee(a,e,t){return a<=e?e:a>=t?t:a}const ke=["GET","POST","PUT","PATCH","DELETE","HEAD"],we={text:"text/plain",json:"application/json",void:"*/*",readableStream:"application/octet-stream",arrayBuffer:"application/octet-stream",blob:"application/octet-stream"},be={count:2,timeout:1e3,timeoutMax:3e4,timeoutMultiplier:2},k=class k{constructor(e={}){c(this,"cfg");c(this,"get");c(this,"post");c(this,"put");c(this,"patch");c(this,"delete");c(this,"getText");c(this,"postText");c(this,"putText");c(this,"patchText");c(this,"deleteText");c(this,"getVoid");c(this,"postVoid");c(this,"putVoid");c(this,"patchVoid");c(this,"deleteVoid");c(this,"headVoid");if(typeof globalThis.fetch!="function")throw new TypeError("globalThis.fetch is not available");this.cfg=this.normalizeCfg(e);for(const t of ke){const s=t.toLowerCase();if(this[`${s}Void`]=async(r,n)=>await this.fetch({url:r,method:t,responseType:"void",...n}),t==="HEAD")return;this[`${s}Text`]=async(r,n)=>await this.fetch({url:r,method:t,responseType:"text",...n}),this[s]=async(r,n)=>await this.fetch({url:r,method:t,responseType:"json",...n})}}onBeforeRequest(e){var t;return((t=this.cfg.hooks).beforeRequest||(t.beforeRequest=[])).push(e),this}onAfterResponse(e){var t;return((t=this.cfg.hooks).afterResponse||(t.afterResponse=[])).push(e),this}onBeforeRetry(e){var t;return((t=this.cfg.hooks).beforeRetry||(t.beforeRetry=[])).push(e),this}onError(e){var t;return((t=this.cfg.hooks).onError||(t.onError=[])).push(e),this}static create(e={}){return new k(e)}async queryGraphQL(e){e.method||(e.method=this.cfg.init.method);const t=se({query:e.query,variables:e.variables});e.method==="GET"&&e.query.length>1900&&(e.method="POST"),e.method==="GET"?e.searchParams={...e.searchParams,...t}:e.json=t;const s=await this.doFetch(e);if(s.err)throw s.err;if(s.body.errors){const n=s.body.errors[0];throw new S(n.message,{...t,errors:s.body.errors,response:s.fetchResponse,responseStatusCode:s.statusCode,requestUrl:s.req.fullUrl,requestBaseUrl:this.cfg.baseUrl,requestMethod:s.req.init.method,requestSignature:s.signature,requestDuration:Date.now()-s.req.started})}const{data:r}=s.body;return e.unwrapObject?r[e.unwrapObject]:r}async getReadableStream(e,t){return await this.fetch({url:e,responseType:"readableStream",...t})}async fetch(e){const t=await this.doFetch(e);if(t.err)throw t.err;return t.body}async expectError(e){const t=await this.doFetch(e);if(!t.err)throw new K("Fetch was expected to error");return z(t.err,S),t.err}async tryFetch(e){const t=await this.doFetch(e);return t.err?(J(t.err,S),[t.err,null]):[null,t.body]}async doFetch(e){var p,g,E;const t=this.normalizeOptions(e),{logger:s}=this.cfg,{timeoutSeconds:r,init:{method:n}}=t;for(const f of this.cfg.hooks.beforeRequest||[])await f(t);const l=t.fullUrl.includes("://")?new URL(t.fullUrl):void 0,h=l?this.getShortUrl(l):t.fullUrl,u=[n,h].join(" "),i={req:t,retryStatus:{retryAttempt:0,retryStopped:!1,retryTimeout:t.retry.timeout},signature:u};for(;!i.retryStatus.retryStopped;){t.started=Date.now();let f;if(r){const d=new AbortController;t.init.signal=d.signal,f=setTimeout(()=>{d.abort(new j(`request timed out after ${r} sec`))},r*1e3)}if(t.logRequest){const{retryAttempt:d}=i.retryStatus;s.log([" >>",u,d&&`try#${d+1}/${t.retry.count+1}`].filter(Boolean).join(" ")),t.logRequestBody&&t.init.body&&s.log(t.init.body)}try{i.fetchResponse=await(this.cfg.fetchFn||k.callNativeFetch)(t.fullUrl,t.init),i.ok=i.fetchResponse.ok,i.err=void 0}catch(d){i.err=q(d),i.ok=!1,i.fetchResponse=void 0}finally{clearTimeout(f)}if(i.statusFamily=this.getStatusFamily(i),i.statusCode=(p=i.fetchResponse)==null?void 0:p.status,(g=i.fetchResponse)!=null&&g.ok||!t.throwHttpErrors)try{await me(async()=>await this.onOkResponse(i),{timeout:r*1e3||Number.POSITIVE_INFINITY,name:"Fetcher.downloadBody"})}catch(d){i.err=q(d),i.ok=!1,await this.onNotOkResponse(i)}else await this.onNotOkResponse(i)}if(i.err){G(i.err,t.errorData),(E=t.onError)==null||E.call(t,i.err);for(const f of this.cfg.hooks.onError||[])await f(i.err)}for(const f of this.cfg.hooks.afterResponse||[])await f(i);return i}async onOkResponse(e){const{req:t}=e,{responseType:s}=e.req;if(s==="json")if(e.fetchResponse.body){const r=await e.fetchResponse.text();r?(e.body=r,e.body=Q(r,t.jsonReviver)):e.body={}}else e.body={};else if(s==="text")e.body=e.fetchResponse.body?await e.fetchResponse.text():"";else if(s==="arrayBuffer")e.body=e.fetchResponse.body?await e.fetchResponse.arrayBuffer():{};else if(s==="blob")e.body=e.fetchResponse.body?await e.fetchResponse.blob():{};else if(s==="readableStream"&&(e.body=e.fetchResponse.body,e.body===null))throw new Error("fetchResponse.body is null");if(e.retryStatus.retryStopped=!0,(!e.err||!t.throwHttpErrors)&&t.logResponse){const{retryAttempt:r}=e.retryStatus,{logger:n}=this.cfg;n.log([" <<",e.fetchResponse.status,e.signature,r&&`try#${r+1}/${t.retry.count+1}`,N(e.req.started)].filter(Boolean).join(" ")),t.logResponseBody&&e.body!==void 0&&n.log(e.body)}}static async callNativeFetch(e,t){return await globalThis.fetch(e,t)}async onNotOkResponse(e){var n;let t;if(!e.body&&e.fetchResponse)try{e.body=X(await e.fetchResponse.text())}catch{}e.err?t=Z(e.err):e.body?t=ee(e.body):t={name:"Error",message:"Fetch failed",data:{}};let s=((n=e.fetchResponse)==null?void 0:n.status)||0;e.statusFamily===2&&(e.statusFamily=void 0,e.statusCode=void 0,s=0);const r=[e.statusCode,e.signature].filter(Boolean).join(" ");e.err=new S(r,v({response:e.fetchResponse,responseStatusCode:s,requestUrl:e.req.fullUrl,requestBaseUrl:this.cfg.baseUrl||void 0,requestMethod:e.req.init.method,requestSignature:e.signature,requestDuration:Date.now()-e.req.started}),{cause:t}),await this.processRetry(e)}async processRetry(e){var l;const{retryStatus:t}=e;this.shouldRetry(e)||(t.retryStopped=!0);for(const h of this.cfg.hooks.beforeRetry||[])await h(e);const{count:s,timeoutMultiplier:r,timeoutMax:n}=e.req.retry;if(t.retryAttempt>=s&&(t.retryStopped=!0),e.err&&(!t.retryStopped||e.req.logResponse)&&this.cfg.logger.error([" <<",((l=e.fetchResponse)==null?void 0:l.status)||0,e.signature,s&&(t.retryAttempt||!t.retryStopped)&&`try#${t.retryAttempt+1}/${s+1}`,N(e.req.started)].filter(Boolean).join(" ")+`
`,te(e.err.cause||e.err)),t.retryStopped)return;t.retryAttempt++,t.retryTimeout=Ee(t.retryTimeout*r,0,n);const o=this.getRetryTimeout(e);e.req.debug&&this.cfg.logger.log(` .. ${e.signature} waiting ${V(o)}`),await he(o)}getRetryTimeout(e){let t=0;if(e.fetchResponse&&[429,503].includes(e.fetchResponse.status)){const s=e.fetchResponse.headers.get("retry-after")??e.fetchResponse.headers.get("x-ratelimit-reset");if(s){if(Number(s))t=Number(s)*1e3;else{const r=new Date(s);Number.isNaN(r)||(t=Number(r)-Date.now())}this.cfg.logger.log(`retry-after: ${s}`),t||this.cfg.logger.warn("retry-after could not be parsed")}}if(!t){const s=Math.random()*500;t=e.retryStatus.retryTimeout+s}return t}shouldRetry(e){var u,i,p,g,E;const{retryPost:t,retry3xx:s,retry4xx:r,retry5xx:n}=e.req,{method:o}=e.req.init;if(o==="POST"&&!t)return!1;const{statusFamily:l}=e,h=((u=e.fetchResponse)==null?void 0:u.status)||0;return l===5&&!n?!1:[408,429].includes(h)?!0:!(l===4&&!r||l===3&&!s||(E=(g=(p=(i=e.err)==null?void 0:i.cause)==null?void 0:p.cause)==null?void 0:g.message)!=null&&E.includes("unexpected redirect"))}getStatusFamily(e){var s;const t=(s=e.fetchResponse)==null?void 0:s.status;if(t){if(t>=500)return 5;if(t>=400)return 4;if(t>=300)return 3;if(t>=200)return 2;if(t>=100)return 1}}getShortUrl(e){const{baseUrl:t}=this.cfg;e.password&&(e=new URL(e.toString()),e.password="[redacted]");let s=e.toString();return this.cfg.logWithSearchParams||(s=s.split("?")[0]),!this.cfg.logWithBaseUrl&&t&&s.startsWith(t)&&(s=s.slice(t.length)),s}normalizeCfg(e){var r;(r=e.baseUrl)!=null&&r.endsWith("/")&&(console.warn(`Fetcher: baseUrl should not end with slash: ${e.baseUrl}`),e.baseUrl=e.baseUrl.slice(0,e.baseUrl.length-1));const{debug:t=!1}=e,s=P({baseUrl:"",inputUrl:"",responseType:"json",searchParams:{},timeoutSeconds:30,retryPost:!1,retry3xx:!1,retry4xx:!1,retry5xx:!0,logger:e.logger||console,debug:t,logRequest:t,logRequestBody:t,logResponse:t,logResponseBody:t,logWithBaseUrl:L(),logWithSearchParams:!0,retry:{...be},init:{method:e.method||"GET",headers:v({"user-agent":k.userAgent,...e.headers}),credentials:e.credentials,redirect:e.redirect},hooks:{},throwHttpErrors:!0,errorData:{}},B(e,["method","credentials","headers","redirect","logger"]));return s.init.headers=C(s.init.headers,n=>n.toLowerCase()),s}normalizeOptions(e){var n;const t={...re(this.cfg,["timeoutSeconds","retryPost","retry4xx","retry5xx","responseType","jsonReviver","logRequest","logRequestBody","logResponse","logResponseBody","debug","throwHttpErrors","errorData"]),started:Date.now(),...B(e,["method","headers","credentials"]),inputUrl:e.url||"",fullUrl:e.url||"",retry:{...this.cfg.retry,...$(e.retry||{})},init:P({...this.cfg.init,headers:{...this.cfg.init.headers},method:e.method||this.cfg.init.method,credentials:e.credentials||this.cfg.init.credentials,redirect:e.redirect||this.cfg.init.redirect||"follow"},{headers:C(e.headers||{},o=>o.toLowerCase())})};v(t.init.headers,!0);const s=e.baseUrl||this.cfg.baseUrl;s&&(t.fullUrl.startsWith("/")&&(console.warn("Fetcher: url should not start with / when baseUrl is specified"),t.fullUrl=t.fullUrl.slice(1)),t.fullUrl=`${s}/${t.inputUrl}`);const r=$({...this.cfg.searchParams,...e.searchParams});if(Object.keys(r).length){const o=new URLSearchParams(r).toString();t.fullUrl+=(t.fullUrl.includes("?")?"&":"?")+o}return e.json!==void 0?(t.init.body=JSON.stringify(e.json),t.init.headers["content-type"]="application/json"):e.text!==void 0?(t.init.body=e.text,t.init.headers["content-type"]="text/plain"):e.form?e.form instanceof URLSearchParams||e.form instanceof FormData?t.init.body=e.form:(t.init.body=new URLSearchParams(e.form),t.init.headers["content-type"]="application/x-www-form-urlencoded"):e.body!==void 0&&(t.init.body=e.body),(n=t.init.headers).accept||(n.accept=we[t.responseType]),t}};c(k,"VERSION",2),c(k,"userAgent",L()?`fetcher${k.VERSION}`:void 0);let A=k;function Te(a={}){return A.create(a)}const Re={class:"app-content"},Se={key:0},_e={key:1},xe=["disabled","onClick"],Ue=ae({__name:"TranslationDemo",setup(a){const e=O(new ge({defaultLocale:"en",currentLocale:"en",supportedLocales:["en","ru"],translationLoader:new ue(Te({baseUrl:"lang"}))})),t=O(!0),s=M(()=>e.value.translate("key1")),r=M(()=>e.value.translate("key2"));return ne(async()=>{await e.value.loadLocale(["en","ru"]),t.value=!1}),(n,o)=>(b(),w("div",Re,[t.value?(b(),w("div",Se,"Loading...")):(b(),w("pre",_e,[o[0]||(o[0]=U("translationService.currentLocale == ")),(b(!0),w(ie,null,oe(e.value.cfg.supportedLocales,l=>(b(),w("button",{disabled:e.value.currentLocale===l,onClick:h=>e.value.currentLocale=l},_(l),9,xe))),256)),U(`
key1: "`+_(s.value)+`"
key2: "`+_(r.value)+`"

translationService.locales: `+_(e.value.locales)+`
`,1)]))]))}}),Fe={id:"translationservice",tabindex:"-1"},Oe=JSON.parse('{"title":"TranslationService","description":"","frontmatter":{},"headers":[],"relativePath":"translation.md","filePath":"translation.md"}'),ve={name:"translation.md"},Me=Object.assign(ve,{setup(a){return(e,t)=>{const s=le("Badge");return b(),w("div",null,[I("h1",Fe,[t[0]||(t[0]=U("TranslationService ")),H(s,{text:"experimental",type:"warning"}),t[1]||(t[1]=U()),t[2]||(t[2]=I("a",{class:"header-anchor",href:"#translationservice","aria-label":'Permalink to "TranslationService <Badge text="experimental" type="warning"/>"'},"​",-1))]),t[3]||(t[3]=ce(`<h2 id="demo" tabindex="-1">Demo <a class="header-anchor" href="#demo" aria-label="Permalink to &quot;Demo&quot;">​</a></h2><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> translationService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TranslationService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  defaultLocale: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;en&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  supportedLocales: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;en&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ru&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  translationLoader: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FetchTranslationLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prefixUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;lang&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">translationService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">translate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;key1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// value 1 en</span></span></code></pre></div>`,2)),H(Ue)])}}});export{Oe as __pageData,Me as default};
